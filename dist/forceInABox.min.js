// https://github.com/john-guerra/forceInABox#readme v1.0.1 Copyright 2024 undefined
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3")):"function"==typeof define&&define.amd?define(["d3"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).forceInABox=t(e.d3)}(this,(function(e){"use strict";function t(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var n=t(e);return function(){function e(e){return()=>e}let t,r,o=function(e){return e.index},c=[],i=[],u=[100,100],f=e(1),l=e(-1),s=e(100),a=e(.1),g={},d=.1,h=.001,p=[],y=[0,0],x=function(e){return e.cluster},m="treemap",k=!0,v=.1;function z(e){if(!k)return z;"force"===m&&(r.tick(),S());for(let t,n=0,r=c.length,o=e*v;n<r;++n)t=c[n],t.vx+=(g[x(t)].x-t.x)*o,t.vy+=(g[x(t)].y-t.y)*o}function b(){c&&("treemap"===m?function(){let e=n.treemap().size(z.size());t=n.hierarchy(function(){let e,t,n,r=[];for(e of(n=w(z.nodes()),n.keys()))t=n.get(e),r.push({id:e,size:t.count});return{id:"clustersTree",children:r}}()).sum((function(e){return e.size})).sort((function(e,t){return t.height-e.height||t.value-e.value})),p=e(t).leaves(),S()}():function(){let e;if(!c||!c.length)return;if(c&&c.length>0&&void 0===x(c[0]))throw Error("Couldnt find the grouping attribute for the nodes. Make sure to set it up with forceInABox.groupBy('clusterAttr') before calling .links()");(function(){let e=0;if(0===c.length)return;i.forEach((function(t){let n,r;if(c){if(n=t.source,r=t.target,"object"!=typeof t.source&&(n=c[t.source]),"object"!=typeof t.target&&(r=c[t.target]),void 0===n||void 0===r)throw Error("Error setting links, couldnt find nodes for a link (see it on the console)");t.source=n,t.target=r,t.index=e++}}))})(),e=function(){let e,t,n,r,o,u=[],f=[],l=new Map;for(e of(r=w(c),o=function(e){let t=new Map,n=[];return e.forEach((function(e){let n,r=function(e){let t=x(e.source),n=x(e.target);return t<=n?t+"~"+n:n+"~"+t}(e);n=t.has(r)?t.get(r):0,n+=1,t.set(r,n)})),t.forEach((function(e,t){let r,o;r=t.split("~")[0],o=t.split("~")[1],void 0!==r&&void 0!==o&&n.push({source:r,target:o,count:e})})),n}(i),r.keys()))n=r.get(e),u.push({id:e,size:n.count,r:Math.sqrt(n.sumforceNodeSize/Math.PI)}),l.set(e,t);return o.forEach((function(e){let t=l.get(e.source),n=l.get(e.target);void 0!==t&&void 0!==n&&f.push({source:t,target:n,count:e.count})})),{nodes:u,links:f}}(),r=n.forceSimulation(e.nodes).force("x",n.forceX(u[0]/2).strength(.1)).force("y",n.forceY(u[1]/2).strength(.1)).force("collide",n.forceCollide((function(e){return e.r})).iterations(4)).force("charge",n.forceManyBody().strength(l)).force("links",n.forceLink(e.nodes.length?e.links:[]).distance(s).strength(a)),p=r.nodes(),S()}())}function w(e){let t=new Map,n={};return e.forEach((function(e){t.has(x(e))||t.set(x(e),{count:0,sumforceNodeSize:0})})),e.forEach((function(e){n=t.get(x(e)),n.count=n.count+1,n.sumforceNodeSize=n.sumforceNodeSize+Math.PI*(f(e)*f(e))*1.3,t.set(x(e),n)})),t}function S(){return g.none={x:0,y:0},p.forEach((function(e){"treemap"===m?g[e.data.id]={x:e.x0+(e.x1-e.x0)/2-y[0],y:e.y0+(e.y1-e.y0)/2-y[1]}:g[e.id]={x:e.x-y[0],y:e.y-y[1]}})),g}function E(e){e.selectAll("rect.cell").remove();let t=e.selectAll("line.cell").data(r.force("links").links());t.enter().append("line").attr("class","cell").merge(t).attr("x2",(function(e){return e.source.x})).attr("y2",(function(e){return e.source.y})).attr("x1",(function(e){return e.target.x})).attr("y1",(function(e){return e.target.y})).style("stroke-width","1px").style("stroke-opacity","0.5");let n=e.selectAll("circle.cell").data(r.nodes());n.enter().append("svg:circle").attr("class","cell").merge(n).attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y})).attr("r",(function(e){return e.r})),r.on("tick",(()=>{E(e)})).restart(),n.exit().remove(),t.exit().remove()}return z.initialize=function(e){c=e,b()},z.drawTemplate=function(e){return"treemap"===m?function(e){e.selectAll("circle.cell").remove(),e.selectAll("line.cell").remove(),e.selectAll("rect.cell").data(p).enter().append("svg:rect").attr("class","cell").attr("x",(function(e){return e.x0})).attr("y",(function(e){return e.y0})).attr("width",(function(e){return e.x1-e.x0})).attr("height",(function(e){return e.y1-e.y0}))}(e):E(e),z},z.drawTreemap=z.drawTemplate,z.deleteTemplate=function(e){return e.selectAll(".cell").remove(),r&&r.on("tick",null).restart(),z},z.template=function(e){return arguments.length?(m=e,b(),z):m},z.groupBy=function(e){return arguments.length?"string"==typeof e?(x=function(t){return t[e]},z):(x=e,z):x},z.enableGrouping=function(e){return arguments.length?(k=e,z):k},z.strength=function(e){return arguments.length?(v=e,z):v},z.getLinkStrength=function(e){return k?x(e.source)===x(e.target)?"function"==typeof d?d(e):d:"function"==typeof h?h(e):h:"function"==typeof d?d(e):d},z.id=function(e){return arguments.length?(o=e,z):o},z.size=function(e){return arguments.length?(u=e,z):u},z.linkStrengthInterCluster=function(e){return arguments.length?(h=e,z):h},z.linkStrengthIntraCluster=function(e){return arguments.length?(d=e,z):d},z.nodes=function(e){return arguments.length?(c=e,z):c},z.links=function(e){return arguments.length?(i=null===e?[]:e,b(),z):i},z.forceNodeSize=function(t){return arguments.length?(f="function"==typeof t?t:e(+t),b(),z):f},z.nodeSize=z.forceNodeSize,z.forceCharge=function(t){return arguments.length?(l="function"==typeof t?t:e(+t),b(),z):l},z.forceLinkDistance=function(t){return arguments.length?(s="function"==typeof t?t:e(+t),b(),z):s},z.forceLinkStrength=function(t){return arguments.length?(a="function"==typeof t?t:e(+t),b(),z):a},z.offset=function(t){return arguments.length?(y="function"==typeof t?t:e(+t),z):y},z.getFocis=S,z}}));
